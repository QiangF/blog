---
layout: post
author: Train
description: "直接在Sublime Text2编辑器中运行Python程序的设置方法"
keywords: "numpy, Python, 数值积分"
mathjax: true
---

当上限法拓展应用到三维成形问题，三重积分就在所难免了；并且考虑到积分区域无法解析表达，此时数值积分就是唯一的选择。之前的文章<a href="http://http://scientia.sinaapp.com/%E4%B8%8A%E9%99%90%E6%B3%95%E4%B8%AD%E5%A1%91%E6%80%A7%E5%8A%9F%E7%9A%84%E6%95%B0%E5%80%BC%E7%A7%AF%E5%88%86%E7%AE%97%E4%BE%8B%E5%88%86%E6%9E%90/" target="_blank">上限法中塑性功的数值积分算例——二重积分</a>提到了区域离散后数值积分在处理复杂积分区域上具有优势，本文即以具体示例介绍上限法解题过程中可能遇到的体积积分的问题。

示例：在半径为1的八分之一球体(Omega)（三维坐标系第一象限）上对(f(x,y,z))进行积分，即[int_{Omega}{f(x,y,z)dV}]

特别地，当(f(x,y,z)=1)时，就是求八分之一球的体积。

<!--more-->
<h3>计算思路</h3>
思路其实很明晰：

1、建立球体的几何模型

2、划分网格得到单元及节点坐标数据，编程读入网格数据

这个可以在网格划分软件中执行，保存的文件格式选取通用的Nastran格式，或者其他的包含单元信息的文件，例如Marc的.dat格式。然后根据保存的文件格式，将数据读入到自己的程序中来。

3、进行数值积分计算

将积分区域离散后，以有限积分点的插值数据来替代单元上连续的函数值，得到每个单元的数值积分结果，最后求和。$$int_{Omega}{f(x,y,z)dV} = sum_{i=1}^m{left[int_{V_i}f(x_i,y_i,z_i)dVright]} = sum_{i=1}^m{f(x_i,y_i,z_i)V_i}$$
<h3>计算实例</h3>
本文采用的是一个开源的集成有限元前后处理的网格生成程序Gmsh完成建模与网格划分，项目参见
<blockquote><a href="http://www.geuz.org/gmsh/" target="_blank">Gmsh: a three-dimensional finite element mesh generator with built-in pre- and post-processing facilities</a></blockquote>
编程语言采用了Python的科学计算模块NumPy。

本次计算中采用的是四面体单元，因为四面体具有简易的体积计算公式。积分方案为Hammer积分，根据积分精度可选取线性、二次及三次积分点，参见王勖成《有限单元法》Page 151. 本次计算直接采用线性的积分方案，即以四面体单元四个节点上函数值的平均值作为单元的函数值。

<div align='center'><img src="{{ "/images/2014-12-24_01.jpg" | prepend: site.baseurl }}"></div>

根据被积函数的不同，下面列出两组计算结果。比较数据为matlab的三重数值积分。

<a href="http://127.0.0.3/wordpress/wp-content/uploads/2014/12/2014-12-24_165146.png"><img class="aligncenter size-full wp-image-817" src="http://127.0.0.3/wordpress/wp-content/uploads/2014/12/2014-12-24_165146.png" alt="2014-12-24_165146" width="630" height="251" /></a>

&nbsp;

注：<em>将积分区域转为球坐标系后，各个积分限都为常数，从而可直接使用matlab的三重数值积分函数。</em>
<pre class="lang:matlab decode:true ">triplequad(@(x,y,z) x.^2.*sin(y).*sin(x.*sin(y).*cos(z)+(x.*sin(y).*sin(z)).^2+(x.*cos(y)).^0.5).^2,0,1,0,pi/2,0,pi/2)</pre>
网格划分数量与解的收敛性关系如下图所示，可以看出离散积分具有收敛性，并且当单元细化到一定级别后，继续通过细化的方式提升计算精度的效率急剧下降。

<a href="http://127.0.0.3/wordpress/wp-content/uploads/2014/12/2014-12-24_171359.png"><img class="aligncenter size-full wp-image-819" src="http://127.0.0.3/wordpress/wp-content/uploads/2014/12/2014-12-24_171359.png" alt="2014-12-24_171359" width="554" height="385" /></a>

&nbsp;

&nbsp;