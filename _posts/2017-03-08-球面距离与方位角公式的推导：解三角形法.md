---
layout: post
author: Train
description: "解三角形法推导已知经纬度的两点间的球面距离和方位角"
keywords: "经纬度, 球面距离, 方位角, 球面三角形"
mathjax: true
---

根据地球上任意两地的经纬度，可以计算它们在球面上的最短距离（Great-circle Distance / Orthodromic Distance）
及相对始末位置的方位角（Bearing）。本文使用解三角形法推导上述公式。

## 基本概念

`纬度`是地球上某点与球心的连线与地球赤道面所成的线面角（如图所示$\varphi$），北纬为正数，南纬为负数。

`经度`是地球上某点经线平面与本初子午面所成的二面角（如图所示的$\lambda$），东经为正数，西经为负数。

球面上两点P、Q的最短距离为过P、Q的大圆对应两点之间的劣弧的长度（如图实线所示$\overset{\frown}{PQ}$）。

`方位角`是从某点的指北方向线起，依顺时针方向到目标方向线之间的水平夹角（如图所示$\theta$）。

<div align='center'><img src="{{ "/images/2017-03-08-01.png" | prepend: site.baseurl }}"></div>

## 基本公式及其推导

将地球近似为平均半径$R=6371km$的标准球体，可以得到根据两点经纬度计算球面距离及方位角的公式。
基本推导方法为解三角形，包括平面三角形和球面三角形的基本知识。

### 球面距离

球面距离$d$的常用公式为`Haversine`公式：

\begin{align\*}
a &= \sin^2\frac{\Delta\varphi}{2} + \cos\varphi_1 * \cos\varphi_2 * sin^2\frac{\Delta\lambda}{2}\\\\\\
\delta &= 2\,atan2\frac{\sqrt{a}}{\sqrt{1-a}} \\\\\\
d &= R*\delta
\end{align\*}

其中，$\varphi$是纬度，$\lambda$是经度，$R$是地球平均半径。注意，代入计算中的经、纬度为换算后的弧度值。

如果在球面三角形NPQ中直接使用球面三角形的余弦公式，则得到

\begin{align\*}
\delta &= \acos(\sin\phi_1*\sin\phi_2 + \cos\phi_1*\cos\phi_2*\cos\Delta\lambda) \\\\\\
d &= R*\delta
\end{align\*}

上式具有更简洁的形式，不过当P、Q相邻很近即$\delta$趋近于0时，$\cos\delta$趋近于1。
其后果是一旦计算设备的精度不够，可能由于舍入误差而导致错误的结果。

### 方位角

### 已知起始点、方位角及距离，求目标位置

## 参考资料




